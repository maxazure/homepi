<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>壁纸显示程序</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <style>
      body {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background-color: #000;
      }
      
      #wallpaper {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 0.5s ease-in-out;
      }
    </style>
  </head>
  <body>
    <img id="wallpaper" src="" alt="壁纸">
    <script>
      const { ipcRenderer } = require('electron');
      const fs = require('fs');
      const path = require('path');

      // 支持的图片格式
      const SUPPORTED_FORMATS = ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp'];

      // 获取随机壁纸
      function getRandomWallpaper() {
        const wallpapersDir = path.join(__dirname, 'wallpapers');
        const files = fs.readdirSync(wallpapersDir);
        const imageFiles = files.filter(file => 
          SUPPORTED_FORMATS.includes(path.extname(file).toLowerCase())
        );
        
        if (imageFiles.length === 0) {
          console.error('没有找到支持的图片文件');
          return null;
        }
        
        const randomFile = imageFiles[Math.floor(Math.random() * imageFiles.length)];
        return path.join(wallpapersDir, randomFile);
      }

      // 更换壁纸
      function changeWallpaper() {
        const wallpaperPath = getRandomWallpaper();
        if (wallpaperPath) {
          const img = document.getElementById('wallpaper');
          img.style.opacity = '0';
          
          setTimeout(() => {
            img.src = wallpaperPath;
            img.style.opacity = '1';
          }, 500);
        }
      }

      // 设置定时器，每5分钟更换一次壁纸
      setInterval(changeWallpaper, 5 * 60 * 1000);

      // 初始加载一张壁纸
      changeWallpaper();
    </script>
  </body>
</html>